<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Bulk Experiment • disize</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Bulk Experiment">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">disize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.13</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a-bulk-experiment.html">A Bulk Experiment</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A Bulk Experiment</h1>
            
      

      <div class="d-none name"><code>a-bulk-experiment.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://toddmccready.github.io/disize/">disize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/curl" class="external-link">curl</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Using libcurl 8.5.0 with OpenSSL/3.0.13</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://henrikbengtsson.github.io/R.utils/" class="external-link">R.utils</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: R.oo</span></span>
<span><span class="co">#&gt; Loading required package: R.methodsS3</span></span>
<span><span class="co">#&gt; R.methodsS3 v1.8.2 (2022-06-13 22:00:14 UTC) successfully loaded. See ?R.methodsS3 for help.</span></span>
<span><span class="co">#&gt; R.oo v1.27.1 (2025-05-02 21:00:05 UTC) successfully loaded. See ?R.oo for help.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'R.oo'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:R.methodsS3':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     throw</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:methods':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     getClasses, getMethods</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     attach, detach, load, save</span></span>
<span><span class="co">#&gt; R.utils v2.13.0 (2025-02-24 21:20:02 UTC) successfully loaded. See ?R.utils for help.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'R.utils'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     timestamp</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     cat, commandArgs, getOption, isOpen, nullfile, parse, use, warnings</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-dataset">The dataset<a class="anchor" aria-label="anchor" href="#the-dataset"></a>
</h2>
<p>This dataset consists of a purified macrophage subtype(“Mac2”,
supposedly in an ‘activated’ state) that has been partitioned into four
groups exposed to different conditions. The authors offer this
information on how the samples were processed:</p>
<blockquote>
<p>The sorted Mac2 cells were divided into four groups and stimulated at
the 3-h time point with the same concentrations as previously described.
Then, the RNA was extracted using the RNeasy Plus Micro Kit as per
manufacturer instructions. Poly(A)mRNA was isolated using mRNA Capture
Beads 2.0 (Yeasen Cat.12629ES, CHN) with two rounds of purification,
followed by RNA fragmentation with magnesium ions at 94°C (Yeasen
Cat.12340ES97, CHN). RNA sequencing library preparation was performed
using the TruSeq RNA Library Prep Kit v2 (Illumina). Sequencing was
carried out as paired-end 2×150 bp (PE150) on an Illumina Novaseq™ X
Plus (LC-Bio Technologies).</p>
</blockquote>
<p>The TruSeq RNA Library Prep Kit involves “tagging” transcripts with
barcodes that identify distinct <em>samples</em>, allowing all prepared
cDNA libraries to be pooled together before sequencing. Since
batch-effects are usually attributed to separate sequencing runs, then
we expect very small batch-effects to be present in this dataset if we
define a “batch” as the unit subjected to RNA extraction(and all further
processing).</p>
<p>Let us test this hypothesis:</p>
</div>
<div class="section level2">
<h2 id="downloading-the-data">Downloading the data<a class="anchor" aria-label="anchor" href="#downloading-the-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download counts and construct metadata</span></span>
<span><span class="va">counts_path</span> <span class="op">&lt;-</span> <span class="fu">curl</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/curl/reference/curl_download.html" class="external-link">curl_download</a></span><span class="op">(</span></span>
<span>    url <span class="op">=</span> <span class="st">"https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE273924&amp;format=file&amp;file=GSE273924%5Fraw%5Fcounts%2Etsv%2Egz"</span>,</span>
<span>    destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/counts.tsv.gz"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">counts_path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">"sample_id"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="st">"condition"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"lps"</span>, <span class="st">"nelps"</span>, <span class="st">"ne"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Coerce to formatted matrix</span></span>
<span><span class="va">gene_names</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">$</span><span class="va">gene_id</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">counts</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gene_names</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-disize">Running <code>disize</code><a class="anchor" aria-label="anchor" href="#running-disize"></a>
</h2>
<p>The <code>metadata</code> contains the information for the
experimental design:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt;    sample_id condition</span></span>
<span><span class="co">#&gt; 1      Ctrl1   control</span></span>
<span><span class="co">#&gt; 2      Ctrl2   control</span></span>
<span><span class="co">#&gt; 3      Ctrl3   control</span></span>
<span><span class="co">#&gt; 4       LPS1       lps</span></span>
<span><span class="co">#&gt; 5       LPS2       lps</span></span>
<span><span class="co">#&gt; 6       LPS3       lps</span></span>
<span><span class="co">#&gt; 7     NELPS1     nelps</span></span>
<span><span class="co">#&gt; 8     NELPS2     nelps</span></span>
<span><span class="co">#&gt; 9     NELPS3     nelps</span></span>
<span><span class="co">#&gt; 10       NE1        ne</span></span>
<span><span class="co">#&gt; 11       NE2        ne</span></span>
<span><span class="co">#&gt; 12       NE3        ne</span></span></code></pre></div>
<p>For this dataset, the study was primarily interested in the effect of
<code>condition</code> on expression, thus the formula we would input
into <code>disize</code> is:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">condition</span></span></code></pre></div>
<p>We can finally run <code>disize</code> to get the estimated size
factors:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size_factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/disize.html">disize</a></span><span class="op">(</span></span>
<span>    <span class="va">design_formula</span>,</span>
<span>    <span class="va">counts</span>,</span>
<span>    <span class="va">metadata</span>,</span>
<span>    batch_name <span class="op">=</span> <span class="st">"sample_id"</span>,</span>
<span>    verbose <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Formatting data...</span></span>
<span><span class="co">#&gt; ar: creating stan/lib/stan_math/lib/sundials_6.1.1/lib/libsundials_nvecserial.a</span></span>
<span><span class="co">#&gt; ar: creating stan/lib/stan_math/lib/sundials_6.1.1/lib/libsundials_cvodes.a</span></span>
<span><span class="co">#&gt; ar: creating stan/lib/stan_math/lib/sundials_6.1.1/lib/libsundials_idas.a</span></span>
<span><span class="co">#&gt; ar: creating stan/lib/stan_math/lib/sundials_6.1.1/lib/libsundials_kinsol.a</span></span>
<span><span class="co">#&gt; /home/runner/.cmdstan/cmdstan-2.36.0/stan/lib/stan_math/lib/tbb_2020.3/build/Makefile.tbb:28: CONFIG: cfg=release arch=intel64 compiler=gcc target=linux runtime=cc13.3.0_libc2.39_kernel6.11.0</span></span>
<span><span class="co">#&gt; In file included from ../tbb_2020.3/src/tbb/concurrent_hash_map.cpp:17:</span></span>
<span><span class="co">#&gt; ../tbb_2020.3/include/tbb/concurrent_hash_map.h:347:23: warning: ‘template&lt;class _Category, class _Tp, class _Distance, class _Pointer, class _Reference&gt; struct std::iterator’ is deprecated [-Wdeprecated-declarations]</span></span>
<span><span class="co">#&gt;   347 |         : public std::iterator&lt;std::forward_iterator_tag,Value&gt;</span></span>
<span><span class="co">#&gt;       |                       ^~~~~~~~</span></span>
<span><span class="co">#&gt; In file included from /usr/include/c++/13/bits/stl_construct.h:61,</span></span>
<span><span class="co">#&gt;                  from /usr/include/c++/13/bits/stl_tempbuf.h:61,</span></span>
<span><span class="co">#&gt;                  from /usr/include/c++/13/memory:66,</span></span>
<span><span class="co">#&gt;                  from ../tbb_2020.3/include/tbb/tbb_stddef.h:452,</span></span>
<span><span class="co">#&gt;                  from ../tbb_2020.3/include/tbb/concurrent_hash_map.h:23:</span></span>
<span><span class="co">#&gt; /usr/include/c++/13/bits/stl_iterator_base_types.h:127:34: note: declared here</span></span>
<span><span class="co">#&gt;   127 |     struct _GLIBCXX17_DEPRECATED iterator</span></span>
<span><span class="co">#&gt;       |                                  ^~~~~~~~</span></span>
<span><span class="co">#&gt; cc1plus: note: unrecognized command-line option ‘-Wno-unknown-warning-option’ may have been intended to silence earlier diagnostics</span></span>
<span><span class="co">#&gt; In file included from ../tbb_2020.3/src/tbb/concurrent_queue.cpp:22:</span></span>
<span><span class="co">#&gt; ../tbb_2020.3/include/tbb/internal/_concurrent_queue_impl.h:749:21: warning: ‘template&lt;class _Category, class _Tp, class _Distance, class _Pointer, class _Reference&gt; struct std::iterator’ is deprecated [-Wdeprecated-declarations]</span></span>
<span><span class="co">#&gt;   749 |         public std::iterator&lt;std::forward_iterator_tag,Value&gt; {</span></span>
<span><span class="co">#&gt;       |                     ^~~~~~~~</span></span>
<span><span class="co">#&gt; In file included from /usr/include/c++/13/bits/stl_construct.h:61,</span></span>
<span><span class="co">#&gt;                  from /usr/include/c++/13/bits/stl_tempbuf.h:61,</span></span>
<span><span class="co">#&gt;                  from /usr/include/c++/13/memory:66,</span></span>
<span><span class="co">#&gt;                  from ../tbb_2020.3/include/tbb/tbb_stddef.h:452,</span></span>
<span><span class="co">#&gt;                  from ../tbb_2020.3/src/tbb/concurrent_queue.cpp:17:</span></span>
<span><span class="co">#&gt; /usr/include/c++/13/bits/stl_iterator_base_types.h:127:34: note: declared here</span></span>
<span><span class="co">#&gt;   127 |     struct _GLIBCXX17_DEPRECATED iterator</span></span>
<span><span class="co">#&gt;       |                                  ^~~~~~~~</span></span>
<span><span class="co">#&gt; ../tbb_2020.3/include/tbb/internal/_concurrent_queue_impl.h:1013:21: warning: ‘template&lt;class _Category, class _Tp, class _Distance, class _Pointer, class _Reference&gt; struct std::iterator’ is deprecated [-Wdeprecated-declarations]</span></span>
<span><span class="co">#&gt;  1013 |         public std::iterator&lt;std::forward_iterator_tag,Value&gt; {</span></span>
<span><span class="co">#&gt;       |                     ^~~~~~~~</span></span>
<span><span class="co">#&gt; /usr/include/c++/13/bits/stl_iterator_base_types.h:127:34: note: declared here</span></span>
<span><span class="co">#&gt;   127 |     struct _GLIBCXX17_DEPRECATED iterator</span></span>
<span><span class="co">#&gt;       |                                  ^~~~~~~~</span></span>
<span><span class="co">#&gt; cc1plus: note: unrecognized command-line option ‘-Wno-unknown-warning-option’ may have been intended to silence earlier diagnostics</span></span>
<span><span class="co">#&gt; Estimating size factors... (Max ETA: ~154.3s)</span></span>
<span><span class="co">#&gt; Initial log joint probability = -1.34801e+09 </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt; Exception: Exception: neg_binomial_2_log_lpmf: Log location parameter[7] is -inf, but must be finite! (in '/tmp/RtmpxoCj8Q/model-1f9579c0e23c.stan', line 69, column 12 to column 82) (in '/tmp/RtmpxoCj8Q/model-1f9579c0e23c.stan', line 136, column 4 to line 159, column 6) </span></span>
<span><span class="co">#&gt; Error evaluating model log probability: Non-finite function evaluation. </span></span>
<span><span class="co">#&gt; Error evaluating model log probability: Non-finite function evaluation. </span></span>
<span><span class="co">#&gt; Error evaluating model log probability: Non-finite function evaluation. </span></span>
<span><span class="co">#&gt; Error evaluating model log probability: Non-finite function evaluation. </span></span>
<span><span class="co">#&gt;       99  -1.51953e+06       4.93869       1159.75           1           1      114    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      199   -1.4431e+06       2.67787       1355.79           1           1      228    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      299  -1.39484e+06       1.11649       3509.37       0.485           1      346    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      399  -1.35993e+06      0.921902       2118.35           1           1      460    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      499  -1.30412e+06      0.321548       3808.91      0.8728      0.8728      572    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      599  -1.26664e+06      0.777107       5807.63           1           1      676    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      699  -1.24231e+06      0.120545       5845.52           1           1      779    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      799  -1.23398e+06      0.305046       10048.1           1           1      882    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      899  -1.22131e+06     0.0992477       13676.3           1           1      987    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      999   -1.2084e+06     0.0611465       14138.1           1           1     1088    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1099  -1.20353e+06     0.0239288       13635.6           1           1     1192    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1199  -1.20135e+06     0.0265295       9314.15           1           1     1296    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1299  -1.19994e+06     0.0110841       8124.52           1           1     1400    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1399  -1.19776e+06     0.0300346       11687.5       0.957       0.957     1505    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1499  -1.19607e+06      0.051812       14033.4           1           1     1612    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1599  -1.19449e+06    0.00965062         12991      0.4055      0.4055     1717    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1699   -1.1914e+06     0.0363222       16037.1           1           1     1821    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1799  -1.18709e+06     0.0253724       24012.3       0.358       0.358     1928    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1899  -1.18319e+06      0.104005       20725.7           1           1     2031    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1999  -1.18007e+06     0.0298623       19321.9           1           1     2134    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2099  -1.17897e+06    0.00626227       8099.58           1           1     2239    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2199  -1.17841e+06      0.023341       12909.2           1           1     2345    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2299  -1.17755e+06     0.0188638       18222.7           1           1     2448    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2399  -1.17646e+06     0.0275234       16376.5           1           1     2554    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2499  -1.17513e+06      0.021773       14205.6           1           1     2658    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2599  -1.17356e+06     0.0130616       16762.3           1           1     2764    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2699  -1.17125e+06     0.0170061       24111.8           1           1     2869    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2799  -1.16951e+06     0.0136775       39642.4       0.645       0.645     2975    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2899   -1.1677e+06     0.0233559       33040.9      0.7613      0.7613     3079    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2999  -1.16588e+06   0.000677477       13225.4           1           1     3184    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3099  -1.16507e+06   0.000989494       14055.1           1           1     3290    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3199  -1.16459e+06    0.00655321       15777.2           1           1     3395    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3299   -1.1643e+06     0.0142248       14685.4           1           1     3500    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3399  -1.16385e+06    0.00219167       12745.9      0.8922      0.8922     3601    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3499   -1.1631e+06    0.00646666       29385.5       0.277           1     3706    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3599  -1.16261e+06    0.00206358       9671.35           1           1     3808    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3699  -1.16237e+06     0.0123516         16592           1           1     3912    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3799  -1.16189e+06    0.00753053       11319.9           1           1     4020    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3899  -1.16137e+06    0.00367207       25136.7      0.6488      0.6488     4124    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     3999  -1.16089e+06     0.0100906       36815.7           1           1     4229    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     4099  -1.16029e+06     0.0201944       35798.7           1           1     4331    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     4199  -1.15952e+06     0.0141487       21558.7           1           1     4434    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     4299  -1.15888e+06     0.0281153       21374.9           1           1     4538    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     4399  -1.15782e+06     0.0083623       28059.1           1           1     4641    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     4400  -1.15781e+06     0.0171211       44754.9      0.3865           1     4643    </span></span>
<span><span class="co">#&gt; Optimization terminated normally:  </span></span>
<span><span class="co">#&gt;   Maximum number of iterations hit, may not be at an optima </span></span>
<span><span class="co">#&gt; Finished in  97.6 seconds.</span></span>
<span><span class="co">#&gt; Relative size factor gradient: 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">size_factors</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Ctrl1        Ctrl2        Ctrl3         LPS1         LPS2         LPS3 </span></span>
<span><span class="co">#&gt;  0.102787309  0.008243609 -0.097799268  0.094457536  0.003253017  0.111584703 </span></span>
<span><span class="co">#&gt;          NE1          NE2          NE3       NELPS1       NELPS2       NELPS3 </span></span>
<span><span class="co">#&gt; -0.079098467  0.046881015  0.133142755 -0.195826004 -0.163659035 -0.029716770</span></span></code></pre></div>
<p>Evidently the batch-effect is indeed small across most samples! The
samples “NELPS1” and “NELPS2” seem to have been processed slightly
worse, but otherwise the estimated size factors are approximately the
same (within ~0.1).</p>
<p>We can confirm these estimates by rerunning <code>disize</code> with
a larger <code>n_feats</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size_factors_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/disize.html">disize</a></span><span class="op">(</span></span>
<span>    <span class="va">design_formula</span>,</span>
<span>    <span class="va">counts</span>,</span>
<span>    <span class="va">metadata</span>,</span>
<span>    n_feats <span class="op">=</span> <span class="fl">15000</span>,</span>
<span>    batch_name <span class="op">=</span> <span class="st">"sample_id"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Formatting data...</span></span>
<span><span class="co">#&gt; Estimating size factors... (Max ETA: ~234.1s)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">size_factors_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Ctrl1        Ctrl2        Ctrl3         LPS1         LPS2         LPS3 </span></span>
<span><span class="co">#&gt;  0.115498877  0.006439391 -0.086853987  0.074064636 -0.009014388  0.094281506 </span></span>
<span><span class="co">#&gt;          NE1          NE2          NE3       NELPS1       NELPS2       NELPS3 </span></span>
<span><span class="co">#&gt; -0.054210290  0.051809260  0.123565190 -0.190552796 -0.158029576 -0.025045117</span></span></code></pre></div>
<p>Indeed the estimates remain largely the same.</p>
</div>
<div class="section level2">
<h2 id="downstream-analysis">Downstream analysis<a class="anchor" aria-label="anchor" href="#downstream-analysis"></a>
</h2>
<p>WIP</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Todd McCready.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
